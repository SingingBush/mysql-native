language: d
sudo: false

services: mysql

before_script:
    - mysql -e 'SHOW VARIABLES LIKE "%version%";'
    - mysql -e 'CREATE DATABASE mysqln_testdb;'
    - echo 'host=127.0.0.1;port=3306;user=root;pwd=;db=mysqln_testdb' > testConnectionStr.txt

script: dub test -c unittest-vibe

jobs:
  include:
    - stage: Build and Test with DMD on Linux and Mac
      d: dmd
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: dmd-2.075.1
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: dmd-2.074.1
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: dmd-2.073.2
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: dmd-2.072.2
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: dmd-2.071.2
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: dmd
      os: osx
    - d: dmd-2.075.1
      os: osx
    - d: dmd-2.074.1
      os: osx
    - d: dmd-2.073.2
      os: osx
    - d: dmd-2.072.2
      os: osx
    - d: dmd-2.071.2
      os: osx
    - stage: Build and Test with LDC on Linux and Mac
      d: ldc
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: ldc-1.4.0
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: ldc-1.3.0
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: ldc-1.2.0
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: ldc
      os: osx
    - d: ldc-1.4.0
      os: osx
    - d: ldc-1.3.0
      os: osx
    - d: ldc-1.2.0
      os: osx
    - stage: Build and Test with GDC on Linux and Mac
      d: gdc
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: gdc-4.8.5
      addons:
        apt:
          packages: [ libevent-dev ]
    - d: gdc
      os: osx
    - d: gdc-4.8.5
      os: osx
